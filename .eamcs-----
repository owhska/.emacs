;;; === CRITICAL PERFORMANCE CONFIGURATIONS ===
;; RADICAL optimizations that must come BEFORE everything
(setq gc-cons-threshold 400000000)  ; 400MB during loading
(setq read-process-output-max (* 16 1024 1024))  ; 16MB for I/O
(setq inhibit-startup-screen t)
(setq inhibit-startup-message t)
(setq inhibit-startup-echo-area-message t)
(setq initial-major-mode 'fundamental-mode)
(setq initial-scratch-message nil)
(setq message-log-max 1000)
(setq auto-save-default nil)
(setq create-lockfiles nil)

;; Radical UI performance
(setq idle-update-delay 2.0)
(setq redisplay-skip-fontification-on-input t)
(setq auto-window-vscroll nil)

(setq fast-but-imprecise-scrolling t)
(setq jit-lock-stealth-time 10)
(setq jit-lock-defer-time 1.0)
(setq jit-lock-stealth-verbose nil)

;; ULTRA radical minimal interface
(tool-bar-mode -1)
(menu-bar-mode -1) 
(scroll-bar-mode -1)
(setq visible-bell nil)
(setq ring-bell-function 'ignore)
(setq use-dialog-box nil)
(setq use-file-dialog nil)
(setq inhibit-compacting-font-caches t)

;;; === PACKAGE INSTALLATION (MINIMAL) ===
(require 'package)
(setq package-archives '(("melpa" . "https://melpa.org/packages/")
                         ("gnu" . "https://elpa.gnu.org/packages/")))

;; Inicialização de pacotes diferida
(package-initialize)

;;; === TELESCOPE-LIKE INTERFACE (vertico + consult) ===
;; Usaremos vertico sem posframe inicialmente, depois habilitamos se funcionar

(defun my-load-telescope-like-interface ()
  "Load Telescope-like interface with performance optimizations."
  ;; Desabilita icomplete para evitar conflitos
  (when (boundp 'icomplete-mode)
    (icomplete-mode -1))
  
  ;; Instala pacotes se necessário
  (unless (package-installed-p 'vertico)
    (package-refresh-contents)
    (package-install 'vertico))
  
  (unless (package-installed-p 'consult)
    (package-install 'consult))
  
  (unless (package-installed-p 'orderless)
    (package-install 'orderless))
  
  ;; Tenta instalar vertico-posframe apenas se estiver em GUI
  (when (display-graphic-p)
    (unless (package-installed-p 'vertico-posframe)
      (package-refresh-contents)
      (package-install 'vertico-posframe)))
  
  ;; Ativa vertico
  (when (require 'vertico nil t)
    (vertico-mode 1)
    
    ;; Performance optimizations for vertico
    (setq vertico-count 15
          vertico-cycle t
          vertico-resize nil
          vertico-scroll-margin 2)
    
    ;; Orderless completion (fast and flexible)
    (when (require 'orderless nil t)
      (setq completion-styles '(orderless basic)
            completion-category-defaults nil
            completion-category-overrides '((file (styles orderless partial-completion)))))
    
    ;; Se estamos em GUI e vertico-posframe está disponível, ativa
    (when (and (display-graphic-p) (require 'vertico-posframe nil t))
      (vertico-posframe-mode 1)
      (setq vertico-posframe-poshandler 'posframe-poshandler-frame-center
            vertico-posframe-border-width 1
            vertico-posframe-parameters '((left-fringe . 8)
                                          (right-fringe . 8)
                                          (internal-border-width . 1))))
    
    ;; Consult for Telescope-like commands
    (when (require 'consult nil t)
      ;; Performance optimizations for consult
      (setq consult-preview-key "M-."
            consult-narrow-key "<"
            consult-async-min-input 2
            consult-async-input-throttle 0.5
            consult-async-input-debounce 0.2)
      
      ;; Async grep settings
      (when (executable-find "rg")
        (setq consult-grep-args "rg --null --line-buffered --color=never --max-columns=1000 --path-separator / --smart-case --no-heading --line-number .")
        (setq consult-ripgrep-args "rg --null --line-buffered --color=never --max-columns=1000 --path-separator / --smart-case --no-heading --line-number --hidden -g !.git")))))

;; Load after a short delay
(run-with-idle-timer 1 nil 'my-load-telescope-like-interface)

;;; === SEARCH FUNCTIONS (simplificadas) ===

(defun my-find-file ()
  "Find file with consult."
  (interactive)
  (if (fboundp 'consult-find)
      (consult-find)
    (call-interactively 'find-file)))

(defun my-grep-files ()
  "Grep files with consult."
  (interactive)
  (if (fboundp 'consult-grep)
      (consult-grep)
    (call-interactively 'my-grep-in-project)))

(defun my-switch-buffer ()
  "Switch buffer with consult."
  (interactive)
  (if (fboundp 'consult-buffer)
      (consult-buffer)
    (call-interactively 'switch-to-buffer)))

(defun my-ripgrep ()
  "Ripgrep search with consult."
  (interactive)
  (if (fboundp 'consult-ripgrep)
      (consult-ripgrep)
    (call-interactively 'consult-ripgrep)))

;;; === LSP MODE (OPTIMIZED) ===

;; Install and configure LSP mode
(defun my-load-lsp-mode ()
  "Load LSP mode with optimizations."
  ;; Install required packages if necessary
  (unless (package-installed-p 'lsp-mode)
    (package-refresh-contents)
    (package-install 'lsp-mode))
  
  (unless (package-installed-p 'company)
    (package-install 'company))
  
  ;; Configure LSP BEFORE loading
  (setq lsp-keymap-prefix "C-c l")
  (setq lsp-restart 'auto-restart)
  (setq lsp-enable-symbol-highlighting nil)
  (setq lsp-enable-on-type-formatting nil)
  (setq lsp-auto-guess-root t)
  (setq lsp-signature-auto-activate nil)
  (setq lsp-signature-render-documentation nil)
  (setq lsp-ui-sideline-show-code-actions nil)
  (setq lsp-diagnostics-provider :none)
  (setq lsp-ui-doc-enable nil)
  (setq lsp-headerline-breadcrumb-enable nil)
  (setq lsp-auto-execute-action nil)
  (setq lsp-enable-code-action nil)
  (setq lsp-code-action-enable nil)
  
  ;; Load LSP mode
  (when (require 'lsp-mode nil t)
    ;; Configure hooks for specific languages
    (dolist (hook '((python-mode . lsp-deferred)
                    (js-mode . lsp-deferred)
                    (js-jsx-mode . lsp-deferred)
                    (typescript-mode . lsp-deferred)
                    (typescript-ts-mode . lsp-deferred)
                    (elixir-mode . lsp-deferred)
                    (web-mode . lsp-deferred)
                    (c-mode . lsp-deferred)
                    (c++-mode . lsp-deferred)
                    (java-mode . lsp-deferred)
                    (go-ts-mode . lsp-deferred)
                    (rust-mode . lsp-deferred)))
      (add-hook (car hook) (cdr hook)))
    
    ;; Configure company mode for completion
    (when (require 'company nil t)
      (setq company-idle-delay 0.3
            company-minimum-prefix-length 2
            company-selection-wrap-around t
            company-show-numbers t
            company-tooltip-limit 10
            company-tooltip-align-annotations t)
      (global-company-mode 1))))

;; Load LSP after a short delay
(run-with-idle-timer 2 nil 'my-load-lsp-mode)

;;; === EVIL MODE ===

;; Performance configurations BEFORE loading
(setq evil-want-integration nil)
(setq evil-want-C-u-scroll t)
(setq evil-want-C-i-jump nil)
(setq evil-respect-visual-line-mode nil)
(setq evil-search-module 'evil-search)
(setq evil-ex-complete-emacs-commands nil)
(setq evil-ex-interactive-search-history nil)

;; Load evil mode in an organized way
(defun my-load-evil-mode ()
  "Load Evil Mode correctly."
  ;; Install Evil if necessary
  (unless (package-installed-p 'evil)
    (package-refresh-contents)
    (package-install 'evil))
  
  ;; Load and activate Evil
  (when (require 'evil nil t)
    (evil-mode 1)
    
    ;; Configure keybindings
    (define-key evil-normal-state-map (kbd "C-s") 'consult-line)
    (define-key evil-insert-state-map (kbd "C-s") 'consult-line)
    (define-key evil-visual-state-map (kbd "C-s") 'consult-line)))

;; Execute after 1 second
(run-with-idle-timer 1.5 nil 'my-load-evil-mode)

;;; === EVIL MODE SPECIFIC OPTIMIZATIONS ===

;; Optimized GC for Evil Mode operations
(defun my-evil-optimize-gc ()
  "Optimize GC for Evil Mode operations."
  (setq gc-cons-threshold 200000000))

(defun my-evil-restore-gc ()
  "Restore normal GC after Evil operations."
  (setq gc-cons-threshold 80000000))

(add-hook 'evil-insert-state-entry-hook 'my-evil-optimize-gc)
(add-hook 'evil-insert-state-exit-hook 'my-evil-restore-gc)

;;; === ULTRA FAST FILE SEARCH SYSTEM ===

;; Global settings for case-insensitive search
(setq case-fold-search t)
(setq read-file-name-completion-ignore-case t)
(setq completion-ignore-case t)

;; Main file search system
(defun my-find-files ()
  "Case-insensitive file search with intelligent pattern matching."
  (interactive)
  (let ((dir (read-directory-name "Directory: " default-directory))
        (input (read-string "Search pattern: " (my-get-initial-input))))
    (find-name-dired dir (my-process-search-pattern input))))

(defun my-get-initial-input ()
  "Get initial input based on context."
  (cond
   ((buffer-file-name)
    (file-name-sans-extension (file-name-nondirectory (buffer-file-name))))
   ((use-region-p)
    (buffer-substring-no-properties (region-beginning) (region-end)))
   (t "")))

(defun my-process-search-pattern (input)
  "Process search pattern to make it more flexible."
  (cond
   ((string-match-p "[*?]" input) input)
   ((string-match-p "\\.[^.]*$" input)
    (let ((name (file-name-sans-extension input))
          (ext (file-name-extension input)))
      (if (string-empty-p name)
          (concat "*." ext)
        (concat "*" name "*." ext))))
   (t (concat "*" input "*"))))

;; Fast search with find
(defun my-fast-find-files ()
  "Ultra-fast file search using native find."
  (interactive)
  (let ((dir (read-directory-name "Directory: " default-directory))
        (pattern (read-string "Pattern (ex: *Modulo*.java): " "*")))
    (find-file 
     (completing-read "Select file: "
                      (split-string 
                       (shell-command-to-string 
                        (format "find '%s' -type f -iname '%s' 2>/dev/null | head -100" 
                                dir pattern)) "\n" t)))))

;; Search in Git project
(defun my-find-in-git-repo ()
  "Search files in current Git repository."
  (interactive)
  (let ((git-root (locate-dominating-file default-directory ".git")))
    (if git-root
        (let ((default-directory git-root))
          (call-interactively 'my-find-file))
      (call-interactively 'my-find-file))))

;;; === NATIVE SEARCH/COMPLETION SYSTEM ===

;; Native incremental search
(setq search-highlight t)
(setq search-whitespace-regexp ".*?")
(setq isearch-lazy-count t)
(setq isearch-allow-scroll t)
(setq isearch-case-fold-search t)

;;; === FAST SEARCH SYSTEM ===

;; Text search in files
(defun my-grep-in-current-dir ()
  "Search text in current directory (fast)."
  (interactive)
  (let ((pattern (read-string "Text to search: ")))
    (grep (format "grep -nH -r -i \"%s\" ." pattern))))

(defun my-grep-in-project ()
  "Search text in project files."
  (interactive)
  (let ((pattern (read-string "Text to search: "))
        (directory (read-directory-name "Directory: " default-directory)))
    (grep (format "grep -nH -r -i \"%s\" %s" pattern directory))))

;; Enhanced incremental search
(defun my-enhanced-isearch ()
  "Start isearch with symbol at point."
  (interactive)
  (let ((symbol (thing-at-point 'symbol t)))
    (isearch-forward)
    (when symbol
      (isearch-yank-string symbol))))

;; Improved occur
(defun my-occur-symbol ()
  "Search current symbol in buffer with occur."
  (interactive)
  (let ((symbol (thing-at-point 'symbol t)))
    (if symbol
        (occur symbol)
      (call-interactively 'occur))))

(defun my-occur-project ()
  "Search text in all open buffers."
  (interactive)
  (let ((pattern (read-string "Search in all buffers: ")))
    (multi-occur (buffer-list) pattern)))

;;; === PERSONAL CONFIGURATIONS (Minimal) ===
(setq warning-minimum-level :emergency)
(global-set-key [C-tab] 'other-window)
(global-set-key (kbd "C-c c") 'compile)
(global-set-key (kbd "C-c x") 'execute-extended-command)

;;; === CLIPBOARD INTEGRATION ===

;; Configure clipboard integration
(setq select-enable-clipboard t)
(setq select-enable-primary t)
(setq save-interprogram-paste-before-kill t)
(setq mouse-drag-copy-region t)

;; Function to copy to system clipboard
(defun my-copy-to-clipboard ()
  "Copy region to system clipboard."
  (interactive)
  (if (use-region-p)
      (progn
        (kill-ring-save (region-beginning) (region-end))
        (message "Copied to clipboard!"))
    (message "No region selected!")))

;; Function to paste from system clipboard
(defun my-paste-from-clipboard ()
  "Paste from system clipboard."
  (interactive)
  (yank)
  (message "Pasted from clipboard!"))

;; Function to cut to system clipboard
(defun my-cut-to-clipboard ()
  "Cut region to system clipboard."
  (interactive)
  (if (use-region-p)
      (progn
        (kill-region (region-beginning) (region-end))
        (message "Cut to clipboard!"))
    (message "No region selected!")))

;; Configure Evil Mode for better clipboard integration
(defun my-configure-evil-clipboard ()
  "Configure Evil Mode for clipboard operations."
  (when (featurep 'evil)
    (define-key evil-normal-state-map "y" 'evil-yank)
    (define-key evil-visual-state-map "y" 'evil-yank)
    (define-key evil-normal-state-map "p" 'evil-paste-after)
    (define-key evil-normal-state-map "P" 'evil-paste-before)
    (define-key evil-insert-state-map (kbd "C-y") 'yank)))

;; Keybindings
(global-set-key (kbd "C-c C-c") 'my-copy-to-clipboard)
(global-set-key (kbd "C-c C-v") 'my-paste-from-clipboard)
(global-set-key (kbd "C-c C-x") 'my-cut-to-clipboard)
(global-set-key (kbd "C-c y") 'my-copy-to-clipboard)
(global-set-key (kbd "C-c p") 'my-paste-from-clipboard)

;; Set up clipboard after Evil loads
(add-hook 'evil-mode-hook 'my-configure-evil-clipboard)

;; Workaround for terminal Emacs
(when (not (display-graphic-p))
  (cond
   ((executable-find "xclip")
    (setq x-select-enable-clipboard t)
    (defun xclip-copy (start end)
      (interactive "r")
      (shell-command-on-region start end "xclip -selection clipboard"))
    (defun xclip-paste ()
      (interactive)
      (insert (shell-command-to-string "xclip -selection clipboard -o")))
    (global-set-key (kbd "C-c C-c") 'xclip-copy)
    (global-set-key (kbd "C-c C-v") 'xclip-paste))
   
   ((executable-find "pbcopy") ; macOS
    (setq x-select-enable-clipboard t)
    (defun pbcopy-copy (start end)
      (interactive "r")
      (shell-command-on-region start end "pbcopy"))
    (defun pbpaste-paste ()
      (interactive)
      (insert (shell-command-to-string "pbpaste")))
    (global-set-key (kbd "C-c C-c") 'pbcopy-copy)
    (global-set-key (kbd "C-c C-v") 'pbpaste-paste))))

;;; === IMPROVED YANK/POP FUNCTIONALITY ===

(setq yank-excluded-properties t)
(setq yank-pop-change-selection t)

;; Function to show yanked text in minibuffer
(defun my-yank-advice (orig-fun &rest args)
  "Show yanked text in minibuffer."
  (let ((result (apply orig-fun args)))
    (when (and kill-ring (not (string= (car kill-ring) "")))
      (let ((text (car kill-ring)))
        (message "Yanked: %s" 
                 (if (> (length text) 50)
                     (concat (substring text 0 47) "...")
                   text))))
    result))

;; Enable the advice
(advice-add 'yank :around 'my-yank-advice)
(when (featurep 'evil)
  (advice-add 'evil-paste-after :around 'my-yank-advice)
  (advice-add 'evil-paste-before :around 'my-yank-advice))

;; SEARCH SHORTCUTS CONFIGURATION
(global-set-key (kbd "C-s") 'consult-line)
(global-set-key (kbd "C-x C-f") 'find-file)
(global-set-key (kbd "C-c f") 'my-find-file)
(global-set-key (kbd "C-c F") 'my-fast-find-files)
(global-set-key (kbd "C-c g") 'my-find-in-git-repo)
(global-set-key (kbd "C-c r") 'my-grep-files)
(global-set-key (kbd "C-c R") 'my-ripgrep)
(global-set-key (kbd "C-x b") 'my-switch-buffer)

;; Tab settings
(setq tab-width 4)
(setq-default indent-tabs-mode nil)

;;; === RADICAL PERFORMANCE CONFIGURATIONS ===

(defun my-minibuffer-setup-hook ()
  (setq gc-cons-threshold 800000000))

(defun my-minibuffer-exit-hook ()
  (setq gc-cons-threshold 400000000))

(add-hook 'minibuffer-setup-hook #'my-minibuffer-setup-hook)
(add-hook 'minibuffer-exit-hook #'my-minibuffer-exit-hook)

;; ULTRA fast file system
(setq backup-directory-alist `(("." . "~/.emacs.d/backups")))
(setq auto-save-list-file-prefix nil)

;;; === EDITING ESSENTIALS ===

(electric-pair-mode 1)
(show-paren-mode 1)
(setq show-paren-delay 0)

;;; === DISABLE UNNECESSARY FEATURES FOR LSP ===

(setq eldoc-mode nil)
(global-eldoc-mode -1)
(tab-bar-mode -1)
(setq mode-line-misc-info nil)

;;; === NATIVE GIT INTEGRATION ===

(defun my-git-status-info ()
  "Return Git branch and status information."
  (when (and (buffer-file-name)
             (locate-dominating-file default-directory ".git"))
    (let* ((git-dir (locate-dominating-file default-directory ".git"))
           (branch (with-temp-buffer
                     (cd git-dir)
                     (when (zerop (call-process "git" nil t nil 
                                               "branch" "--show-current"))
                       (string-trim (buffer-string)))))
           (status (with-temp-buffer
                     (cd git-dir)
                     (call-process "git" nil t nil "status" "--porcelain")
                     (if (> (buffer-size) 0) "!" ""))))
      (when branch
        (format "  %s%s" branch status)))))

;; Native VC
(setq vc-handled-backends '(Git))
(setq vc-follow-symlinks t)

;; Mode-line minimalista
(setq-default mode-line-format
  '("%e"
    " "
    (:propertize "%b" face mode-line-buffer-id)
    "  "
    (:eval (when-let ((git-info (my-git-status-info)))
             (propertize git-info 'face 'font-lock-type-face)))
    "   "
    (:propertize mode-name face font-lock-keyword-face)
    "   "
    "%l:%c"
    "   " 
    (:eval (when (buffer-modified-p)
	     (propertize "●" 'face 'error)))))

(force-mode-line-update t)

;;; === LANGUAGE MODES ===

(when (fboundp 'typescript-ts-mode)
  (add-to-list 'auto-mode-alist '("\\.tsx?\\'" . typescript-ts-mode)))

(when (fboundp 'go-ts-mode)
  (add-to-list 'auto-mode-alist '("\\.go\\'" . go-ts-mode)))

(add-to-list 'auto-mode-alist '("\\.exs?\\'" . prog-mode))

;;; === APPEARANCE CONFIGURATIONS ===

(custom-set-faces
 ;; Base
 `(default ((t (:background "#181818" :foreground "#e4e4ef"))))
 `(cursor ((t (:background "#ffdd33"))))

 ;; Basic syntax
 `(font-lock-comment-face ((t (:foreground "#7f7f7f" :italic t))))
 `(font-lock-string-face ((t (:foreground "#ffb964"))))
 `(font-lock-doc-face ((t (:foreground "#bdbdbd" :italic t))))
 `(font-lock-keyword-face ((t (:foreground "#96a6c8" :bold t))))
 `(font-lock-function-name-face ((t (:foreground "#73c936"))))
 `(font-lock-type-face ((t (:foreground "#95a99f"))))
 `(font-lock-constant-face ((t (:foreground "#9e95c7"))))
 `(font-lock-variable-name-face ((t (:foreground "#e4e4ef"))))

 ;; UI
 `(hl-line ((t (:background "#282828"))))
 `(region ((t (:background "#303030" :foreground "#e4e4ef"))))
 `(fringe ((t (:background "#181818" :foreground "#303030"))))

 ;; Mode line
 `(mode-line ((t (:background "#282828" :foreground "#e4e4ef" :box (:line-width 1 :color "#303030")))))
 `(mode-line-inactive ((t (:background "#181818" :foreground "#7f7f7f" :box (:line-width 1 :color "#282828")))))

 ;; Search
 `(isearch ((t (:background "#ffdd33" :foreground "#181818" :bold t))))
 `(lazy-highlight ((t (:background "#96a6c8" :foreground "#181818"))))

 ;; Minibuffer
 `(minibuffer-prompt ((t (:foreground "#96a6c8" :bold t))))

 ;; Line numbers
 `(line-number ((t (:inherit default :foreground "#303030" :background "#181818"))))
 `(line-number-current-line ((t (:inherit default :foreground "#bdbdbd" :background "#282828" :bold t))))

 ;; Parentheses
 `(show-paren-match ((t (:background "#96a6c8" :foreground "#181818" :bold t)))))

;; Fonts
(run-with-idle-timer 3 nil
  (lambda ()
    (add-to-list 'default-frame-alist '(font . "Iosevka-14"))))

;;; === LINE NUMBERS ===

(setq display-line-numbers-width nil)
(setq display-line-numbers-grow-only nil)
(setq display-line-numbers-minor-type t)

(add-hook 'prog-mode-hook 'display-line-numbers-mode)
(add-hook 'text-mode-hook 'display-line-numbers-mode)

;; Disable in unnecessary modes
(dolist (hook '(dired-mode-hook vterm-mode-hook shell-mode-hook 
              eshell-mode-hook compilation-mode-hook help-mode-hook 
              info-mode-hook))
  (add-hook hook (lambda () (display-line-numbers-mode -1))))

;;; === NATIVE GIT COMMANDS ===

(defun my-git-status ()
  "Git status using native command."
  (interactive)
  (let ((default-directory (locate-dominating-file default-directory ".git")))
    (if default-directory
        (compile "git status")
      (message "Not a git repository"))))

(defun my-git-log ()
  "Git log using native command."
  (interactive)
  (let ((default-directory (locate-dominating-file default-directory ".git")))
    (if default-directory
        (compile "git log --oneline -20")
      (message "Not a git repository"))))

(global-set-key (kbd "C-x g") 'my-git-status)
(global-set-key (kbd "C-x l") 'my-git-log)

;;; === NAVIGATION CONFIGURATIONS ===

;; Enhanced isearch navigation
(with-eval-after-load 'isearch
  (define-key isearch-mode-map (kbd "<down>") 'isearch-repeat-forward)
  (define-key isearch-mode-map (kbd "<up>") 'isearch-repeat-backward)
  (define-key isearch-mode-map (kbd "C-n") 'isearch-repeat-forward)
  (define-key isearch-mode-map (kbd "C-p") 'isearch-repeat-backward))

;; Enhanced occur navigation
(with-eval-after-load 'occur
  (define-key occur-mode-map (kbd "<down>") 'occur-next)
  (define-key occur-mode-map (kbd "<up>") 'occur-prev)
  (define-key occur-mode-map (kbd "C-n") 'occur-next)
  (define-key occur-mode-map (kbd "C-p") 'occur-prev)
  (define-key occur-mode-map (kbd "TAB") 'occur-next)
  (define-key occur-mode-map (kbd "<backtab>") 'occur-prev)
  (define-key occur-mode-map (kbd "RET") 'occur-mode-goto-occurrence))

;; Enhanced grep navigation
(defun my-setup-grep-navigation ()
  "Set up navigation keys for grep buffers."
  (when (eq major-mode 'grep-mode)
    (local-set-key (kbd "TAB") 'compilation-next-error)
    (local-set-key (kbd "<backtab>") 'compilation-previous-error)
    (local-set-key (kbd "RET") 'compilation-goto-error)))

(add-hook 'grep-mode-hook 'my-setup-grep-navigation)

;; Enhanced compilation navigation
(defun my-setup-compilation-navigation ()
  "Set up navigation keys for compilation buffers."
  (when (eq major-mode 'compilation-mode)
    (local-set-key (kbd "TAB") 'compilation-next-error)
    (local-set-key (kbd "<backtab>") 'compilation-previous-error)
    (local-set-key (kbd "RET") 'compilation-goto-error)))

(add-hook 'compilation-mode-hook 'my-setup-compilation-navigation)

;;; === ADDITIONAL CONFIGURATIONS ===

;; C mode
(setq-default c-basic-offset 4)

;; Emacs Lisp
(add-hook 'emacs-lisp-mode-hook
          (lambda ()
            (local-set-key (kbd "C-c C-j") 'eval-print-last-sexp)))

;; Word wrap
(add-hook 'markdown-mode-hook (lambda () (toggle-word-wrap 1)))

;; File modes
(dolist (pair '(("Cask" . emacs-lisp-mode)
                ("\\.html\\'" . nxml-mode)
                ("\\.xsd\\'" . nxml-mode)
                ("\\.ant\\'" . nxml-mode)
                ("\\.ebi\\'" . lisp-mode)))
  (add-to-list 'auto-mode-alist pair))

;;; === FINAL CONFIGURATIONS ===

;; Automatic confirmations
(defun my-always-yes (&rest args) t)
(advice-add 'yes-or-no-p :override 'my-always-yes)
(advice-add 'y-or-n-p :override 'my-always-yes)

(setq confirm-nonexistent-file-or-buffer nil)
(setq confirm-kill-processes nil)
(setq confirm-kill-emacs nil)

;; Maximize
(run-with-idle-timer 2 nil 'toggle-frame-maximized)

;; FINAL GC reset
(add-hook 'emacs-startup-hook
  (lambda ()
    (setq gc-cons-threshold 80000000)
    (setq auto-save-default t)
    (message "Emacs loaded!")))

;;; === CUSTOM FILE CONFIGURATION ===
(setq custom-file (expand-file-name "custom.el" user-emacs-directory))

(when (file-exists-p custom-file)
  (load custom-file))

(defun my-save-custom-file ()
  "Save customizations to correct file."
  (unless (file-exists-p custom-file)
    (write-region "" nil custom-file))
  (custom-save-all))

(add-hook 'after-init-hook 'my-save-custom-file)

;; MINIMAL final message
(message "Starting Emacs...")
